{
    "vm_defaults": {
        "template": "ubuntu-24.04-standard",
        "cores": 2,
        "memory_mb": 4096,
        "disk_size_gb": 50,
        "storage_pool": "quickOS-vm-disks",
        "network_bridge": "vmbr0"
    },
    "vms": [
        {
            "vmid": 9000,
            "name": "ubuntu-2404-cloud-template",
            "is_template": true,
            "template_image": "noble-server-cloudimg-amd64.img",
            "template_snapshot_name": "initial_clean_state",
            "network_config": {
                "ip": "dhcp",
                "nameserver": "10.0.0.13"
            },
            "user_config": {
                "username": "phoenix_user"
            }
        },
        {
            "vmid": 1001,
            "name": "Portainer",
            "clone_from_vmid": 9000,
            "cores": 4,
            "memory_mb": 8192,
            "disk_size_gb": 32,
            "start_at_boot": true,
            "boot_order": 4,
            "boot_delay": 2,
            "features": [
                "base_setup",
                "trusted_ca",
                "step_cli",
                "docker"
            ],
            "portainer_role": "primary",
            "dependencies": [
                "102"
            ],
            "traefik_service": {
                "name": "portainer",
                "port": 9443
            },
            "network_config": {
                "ip": "10.0.0.111/24",
                "gw": "10.0.0.1",
                "nameserver": "10.0.0.13"
            },
            "user_config": {
                "username": "phoenix_user"
            },
            "volumes": [
                {
                    "type": "nfs",
                    "server": "10.0.0.13",
                    "path": "/quickOS/vm-persistent-data/1001",
                    "mount_point": "/mnt/persistent"
                },
                {
                    "type": "nfs",
                    "server": "10.0.0.13",
                    "path": "/quickOS/portainer_stacks",
                    "mount_point": "/mnt/stacks"
                }
            ],
            "docker_stacks": [
                "portainer_service"
            ],
            "firewall": {
                "enabled": true,
                "rules": [
                    {
                        "type": "out",
                        "action": "ACCEPT",
                        "dest": "10.0.0.153",
                        "proto": "tcp",
                        "port": "443",
                        "comment": "Allow VM to access the Nginx gateway"
                    },
                    {
                        "type": "out",
                        "action": "ACCEPT",
                        "dest": "10.0.0.102",
                        "proto": "tcp",
                        "port": "9001",
                        "comment": "Allow Portainer server to access agent"
                    }
                ]
            }
        },
        {
            "vmid": 1002,
            "name": "drphoenix",
            "clone_from_vmid": 9000,
            "cores": 4,
            "memory_mb": 4096,
            "disk_size_gb": 64,
            "start_at_boot": true,
            "boot_order": 5,
            "boot_delay": 2,
            "features": [
                "base_setup",
                "trusted_ca",
                "step_cli",
                "docker"
            ],
            "portainer_role": "agent",
            "portainer_environment_name": "drphoenix",
            "portainer_agent_hostname": "drphoenix-agent.internal.thinkheads.ai",
            "trigger_sync_on_completion": true,
            "dependencies": [
                "1001"
            ],
            "network_config": {
                "ip": "10.0.0.102/24",
                "gw": "10.0.0.1",
                "nameserver": "10.0.0.13"
            },
            "user_config": {
                "username": "phoenix_user"
            },
            "volumes": [
                {
                    "type": "nfs",
                    "server": "10.0.0.13",
                    "path": "/quickOS/vm-persistent-data/1002",
                    "mount_point": "/mnt/persistent"
                }
            ],
            "docker_stacks": [
                "qdrant_service",
                "thinkheads_ai_app"
            ],
            "docker_firewall_rules": [
                {
                    "chain": "DOCKER-USER",
                    "interface": "eth0",
                    "protocol": "tcp",
                    "port": 9001,
                    "action": "ACCEPT"
                }
            ],
            "firewall": {
                "enabled": true,
                "rules": [
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.111",
                        "proto": "tcp",
                        "port": "9001",
                        "comment": "Allow Portainer server to access agent"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.13",
                        "proto": "tcp",
                        "port": "9001",
                        "comment": "Allow Proxmox host to access agent for health checks"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.13",
                        "proto": "tcp",
                        "port": "9001",
                        "comment": "Allow Proxmox host to access agent for health checks"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.12",
                        "proto": "tcp",
                        "port": "9001",
                        "comment": "Allow Traefik to access Portainer Agent for ACME challenge"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "tcp",
                        "port": "6333",
                        "comment": "Allow access to Qdrant HTTP API"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "tcp",
                        "port": "6334",
                        "comment": "Allow access to Qdrant gRPC API"
                    }
                ]
            }
        }
    ]
}