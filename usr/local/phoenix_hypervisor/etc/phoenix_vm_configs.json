{
    "vm_defaults": {
        "template": "ubuntu-24.04-standard",
        "cores": 2,
        "memory_mb": 4096,
        "disk_size_gb": 50,
        "storage_pool": "quickOS-vm-disks",
        "network_bridge": "vmbr0"
    },
    "vms": [
        {
            "vmid": 9000,
            "name": "ubuntu-2404-cloud-template",
            "is_template": true,
            "template_image": "noble-server-cloudimg-amd64.img",
            "template_snapshot_name": "initial_clean_state",
            "network_config": {
                "ip": "dhcp",
                "nameserver": "10.0.0.13"
            },
            "user_config": {
                "username": "phoenix_user"
            },
            "firewall": {
                "enabled": false,
                "rules": []
            }
        },
        {
            "vmid": 1001,
            "name": "Portainer",
            "clone_from_vmid": 9000,
            "cores": 4,
            "memory_mb": 8192,
            "disk_size_gb": 32,
            "start_at_boot": true,
            "boot_order": 4,
            "boot_delay": 2,
            "features": [
                "base_setup",
                "trusted_ca",
                "step_cli",
                "docker",
                "docker_proxy"
            ],
            "portainer_role": "primary",
            "swarm_role": "manager",
            "dependencies": [
                "102"
            ],
            "traefik_service": {
                "name": "portainer",
                "port": 9443
            },
            "network_config": {
                "ip": "10.0.0.111/24",
                "gw": "10.0.0.1",
                "nameserver": "10.0.0.13"
            },
            "user_config": {
                "username": "phoenix_user"
            },
            "volumes": [
                {
                    "type": "nfs",
                    "server": "10.0.0.13",
                    "path": "/quickOS/vm-persistent-data/1001",
                    "mount_point": "/mnt/persistent"
                },
                {
                    "type": "nfs",
                    "server": "10.0.0.13",
                    "path": "/quickOS/portainer_stacks",
                    "mount_point": "/mnt/stacks"
                }
            ],
            "docker_stacks": [
                "portainer_service"
            ],
            "firewall": {
                "enabled": true,
                "rules": [
                    {
                        "type": "out",
                        "action": "ACCEPT",
                        "dest": "10.0.0.153",
                        "proto": "tcp",
                        "port": "443",
                        "comment": "Allow VM to access the Nginx gateway"
                    },
                    {
                        "type": "out",
                        "action": "ACCEPT",
                        "dest": "10.0.0.102",
                        "proto": "tcp",
                        "port": "9001",
                        "comment": "Allow Portainer server to access agent"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "tcp",
                        "port": "2377",
                        "comment": "Allow Docker Swarm manager communication"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "tcp",
                        "port": "7946",
                        "comment": "Allow Docker Swarm node-to-node communication (TCP)"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "udp",
                        "port": "7946",
                        "comment": "Allow Docker Swarm node-to-node communication (UDP)"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "udp",
                        "port": "4789",
                        "comment": "Allow Docker Swarm overlay network traffic"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.13",
                        "proto": "tcp",
                        "port": "9000",
                        "comment": "Allow Proxmox host to access Portainer API for setup"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "tcp",
                        "port": "9000",
                        "comment": "Allow access to Portainer HTTP API for setup and routing mesh"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.102",
                        "proto": "tcp",
                        "port": "2377",
                        "comment": "Allow Swarm workers to join the manager"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.12",
                        "proto": "tcp",
                        "port": "9443",
                        "comment": "Allow Traefik to proxy to Portainer"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.12",
                        "proto": "tcp",
                        "port": "9443",
                        "comment": "Allow Traefik to proxy to Portainer"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.153",
                        "proto": "tcp",
                        "port": "9443",
                        "comment": "Allow Nginx Gateway to proxy to Portainer"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.13",
                        "proto": "tcp",
                        "port": "9443",
                        "comment": "Allow Proxmox host to access Portainer API for health checks"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.102",
                        "proto": "tcp",
                        "port": "7946",
                        "comment": "Allow Swarm node-to-node communication (TCP)"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.102",
                        "proto": "udp",
                        "port": "7946",
                        "comment": "Allow Swarm node-to-node communication (UDP)"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.102",
                        "proto": "udp",
                        "port": "4789",
                        "comment": "Allow Swarm overlay network traffic"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "icmp",
                        "source": "10.0.0.0/24",
                        "comment": "Allow ICMP from internal network"
                    },
                    {
                        "type": "out",
                        "action": "ACCEPT",
                        "proto": "tcp",
                        "dest": "10.0.0.13",
                        "port": "111",
                        "comment": "Allow NFS rpcbind to hypervisor"
                    },
                    {
                        "type": "out",
                        "action": "ACCEPT",
                        "proto": "udp",
                        "dest": "10.0.0.13",
                        "port": "111",
                        "comment": "Allow NFS rpcbind to hypervisor"
                    },
                    {
                        "type": "out",
                        "action": "ACCEPT",
                        "proto": "tcp",
                        "dest": "10.0.0.13",
                        "port": "2049",
                        "comment": "Allow NFS to hypervisor"
                    },
                    {
                        "type": "out",
                        "action": "ACCEPT",
                        "proto": "udp",
                        "dest": "10.0.0.13",
                        "port": "2049",
                        "comment": "Allow NFS to hypervisor"
                    },
                    {
                        "type": "out",
                        "action": "ACCEPT",
                        "proto": "tcp",
                        "dest": "10.0.0.13",
                        "port": "20048",
                        "comment": "Allow NFS mountd to hypervisor"
                    },
                    {
                        "type": "out",
                        "action": "ACCEPT",
                        "proto": "udp",
                        "dest": "10.0.0.13",
                        "port": "20048",
                        "comment": "Allow NFS mountd to hypervisor"
                    },
                    {
                        "type": "out",
                        "action": "ACCEPT",
                        "dest": "10.0.0.10",
                        "proto": "tcp",
                        "port": "9000",
                        "comment": "Allow outbound communication to Step CA for certificate requests"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.12",
                        "proto": "tcp",
                        "port": "2376",
                        "comment": "Allow Traefik to connect to the secure Docker API"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.12",
                        "proto": "tcp",
                        "port": "2376",
                        "comment": "Allow Traefik to access the secure Docker API"
                    }
                ]
            }
        },
        {
            "vmid": 1002,
            "name": "drphoenix",
            "clone_from_vmid": 9000,
            "cores": 4,
            "memory_mb": 4096,
            "disk_size_gb": 64,
            "start_at_boot": true,
            "boot_order": 5,
            "boot_delay": 2,
            "features": [
                "base_setup",
                "trusted_ca",
                "step_cli",
                "docker"
            ],
            "portainer_role": "agent",
            "swarm_role": "worker",
            "node_labels": [
                "gpu=false"
            ],
            "portainer_environment_name": "drphoenix",
            "portainer_agent_hostname": "drphoenix-agent.internal.thinkheads.ai",
            "trigger_sync_on_completion": true,
            "dependencies": [
                "1001"
            ],
            "network_config": {
                "ip": "10.0.0.102/24",
                "gw": "10.0.0.1",
                "nameserver": "10.0.0.13"
            },
            "user_config": {
                "username": "phoenix_user"
            },
            "volumes": [
                {
                    "type": "nfs",
                    "server": "10.0.0.13",
                    "path": "/quickOS/vm-persistent-data/1002",
                    "mount_point": "/mnt/persistent"
                }
            ],
            "docker_stacks": [
                "qdrant_service"
            ],
            "firewall": {
                "enabled": true,
                "rules": [
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.111",
                        "proto": "tcp",
                        "port": "9001",
                        "comment": "Allow Portainer server to access agent"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.13",
                        "proto": "tcp",
                        "port": "9001",
                        "comment": "Allow Proxmox host to access agent for health checks"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.12",
                        "proto": "tcp",
                        "port": "9001",
                        "comment": "Allow Traefik to access Portainer Agent for ACME challenge"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "tcp",
                        "port": "6333",
                        "comment": "Allow access to Qdrant HTTP API"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "tcp",
                        "port": "6334",
                        "comment": "Allow access to Qdrant gRPC API"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "tcp",
                        "port": "2377",
                        "comment": "Allow Docker Swarm manager communication"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "tcp",
                        "port": "7946",
                        "comment": "Allow Docker Swarm node-to-node communication (TCP)"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "udp",
                        "port": "7946",
                        "comment": "Allow Docker Swarm node-to-node communication (UDP)"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "udp",
                        "port": "4789",
                        "comment": "Allow Docker Swarm overlay network traffic"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "icmp",
                        "source": "10.0.0.13",
                        "comment": "Allow ICMP from hypervisor"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "tcp",
                        "source": "10.0.0.13",
                        "port": "111",
                        "comment": "Allow NFS rpcbind from hypervisor"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "udp",
                        "source": "10.0.0.13",
                        "port": "111",
                        "comment": "Allow NFS rpcbind from hypervisor"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "tcp",
                        "source": "10.0.0.13",
                        "port": "2049",
                        "comment": "Allow NFS from hypervisor"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "udp",
                        "source": "10.0.0.13",
                        "port": "2049",
                        "comment": "Allow NFS from hypervisor"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "tcp",
                        "source": "10.0.0.13",
                        "port": "20048",
                        "comment": "Allow NFS mountd from hypervisor"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "proto": "udp",
                        "source": "10.0.0.13",
                        "port": "20048",
                        "comment": "Allow NFS mountd from hypervisor"
                    },
                    {
                        "type": "out",
                        "action": "ACCEPT",
                        "dest": "10.0.0.10",
                        "proto": "tcp",
                        "port": "9000",
                        "comment": "Allow outbound communication to Step CA for certificate requests"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.111",
                        "proto": "tcp",
                        "port": "2377",
                        "comment": "Allow Swarm manager to communicate with worker"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.111",
                        "proto": "tcp",
                        "port": "7946",
                        "comment": "Allow Swarm node-to-node communication (TCP)"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.111",
                        "proto": "udp",
                        "port": "7946",
                        "comment": "Allow Swarm node-to-node communication (UDP)"
                    },
                    {
                        "type": "in",
                        "action": "ACCEPT",
                        "source": "10.0.0.111",
                        "proto": "udp",
                        "port": "4789",
                        "comment": "Allow Swarm overlay network traffic"
                    }
                ]
            }
        }
    ]
}